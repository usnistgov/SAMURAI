<h1 id="acquisition-code">Acquisition Code</h1>
<p>This directory contains the code required to run the SAMURAI system. This currently requires a direct path and connection to the U:/ network drive. This code has been tested lately with python 3.6 but should be backward compatable with 2.7.</p>
<h2 id="dependencies">dependencies</h2>
<ul>
<li>Anaconda with python 3.X</li>
<li>pyvisa</li>
<li>cannot remember the last one</li>
</ul>
<h3 id="installing-anaconda-and-dependencies">Installing Anaconda and Dependencies</h3>
<ul>
<li>Install Anaconda
<ol type="1">
<li>Go to the anaconda download page <a href="https://www.anaconda.com/distribution/#download-section">here</a></li>
<li>Select the correct operating system and installer</li>
<li>Download and run the executable and follow the installer to install Anaconda 3.X</li>
</ol></li>
<li>Install pyvisa
<ol type="1">
<li>Type into the windows search ‘anaconda prompt’ and run the program</li>
<li>In the terminal run <code>conda install -c conda-forge pyvisa</code> to install pyvisa</li>
</ol></li>
</ul>
<h2 id="subdirectories">Subdirectories</h2>
<h3 id="support">/support</h3>
<p>This subdirectory contains multiple classes and functions to run the SAMURAI system including control for the VNA and Meca500 Robot arm. This contains the following files</p>
<ul>
<li>/support/autoPNAGrabber.py
<ul>
<li>python control of PNAGrabber. Requires PNAGrabber executable to be run from command line with <code>-r</code> flag to ‘press’ the ‘meas all’ button without opening the UI</li>
</ul></li>
<li>/support/Meca500.py
<ul>
<li>Class for controlling Meca500 Robot</li>
</ul></li>
<li>/support/metaFileController.py
<ul>
<li>Class for interacting with already written metafile from a measurement</li>
</ul></li>
<li>/support/pnaController.py
<ul>
<li>Class to interact with PNA to get various settings and set some things on it</li>
</ul></li>
<li>/support/samurai_metaFile.py
<ul>
<li>Class for creating metafile for SAMURAI measurements</li>
</ul></li>
<li>/support/samurai_support.py
<ul>
<li>Some support functions to use. (mainly functions used when USC came out in Aug. 2018 for phased array calibration)</li>
</ul></li>
</ul>
<h1 id="samurai-hardware-information">SAMURAI Hardware Information</h1>
<pre class="mermaid"><code>graph TD;
  A--&gt;B;
  A--&gt;C;
  B--&gt;D;
  C--&gt;D;</code></pre>
<p>(PICTURE OF SETUP)</p>
<h2 id="hardware">Hardware</h2>
<h3 id="meca-500-6-axis-positioner">Meca 500 6 axis positioner</h3>
<p>Small 6 axis positioner.</p>
<ul>
<li><a href="https://www.mecademic.com/products/Meca500-small-robot-arm">Website</a></li>
<li><a href="hardware/datasheets/Meca500-R3-User-Manual.pdf">User Guide</a></li>
<li><a href="hardware/datasheets/Meca500-R3-Programming-Manual.pdf">Programming Manual</a></li>
</ul>
<h3 id="keysight-pna-x-n5245a">Keysight PNA-X (N5245A)</h3>
<p>10MHz to 50GHz VNA. Ports are 2.4mm Male typically with 2.4mm F-F connector savers on them.</p>
<ul>
<li><a href="hardware/datasheets/N5245.pdf">Datasheet</a></li>
</ul>
<h3 id="antennas">Antennas</h3>
<ul>
<li>Sage-millimeter 17dBi WR-28 Horn antenna
<ul>
<li><a href="hardware/datasheets/17dBi_horn_sagemillimeter.pdf">Datasheet</a></li>
</ul></li>
<li>Sage-millimeter 23dBi WR-28 Horn antenna
<ul>
<li><a href="hardware/datasheets/23dBi_horn_sagemillimeter.pdf">Datasheet</a></li>
</ul></li>
</ul>
<h3 id="cables">Cables</h3>
<ul>
<li>Junkosha 2.4mm (M-M) 3m Cables
<ul>
<li>info (link datasheet)</li>
</ul></li>
<li>Junkosha 2.4mm (M-M) 0.25m Cables
<ul>
<li>info (link datasheet)</li>
</ul></li>
</ul>
<h3 id="adapters">Adapters</h3>
<ul>
<li>Sage-millimeter 2.4mm to WR-28 Adapters</li>
</ul>
<h2 id="networking">Networking</h2>
<p>Currently, the samurai system is run over a custom local network run through a simple network switch. This connects to the VNA, Meca500 Robot arm, and eventually cameras.</p>
<h3 id="remote-pna-x-control">Remote PNA-X control</h3>
<p>-Info on Remote KVM setup</p>
<h3 id="ip-and-visa-addresses">IP and VISA Addresses</h3>
<ul>
<li>PNA-X = <a href="http://10.0.0.2">10.0.0.2</a>
<ul>
<li>VISA Address = ‘TCPIP0::10.0.0.2::inst0::INSTR’</li>
</ul></li>
<li>Meca500 = <a href="http://10.0.0.5">10.0.0.5</a>
<ul>
<li>VISA Address = Could not get VISA to work correctly! Connect using sockets.</li>
</ul></li>
<li>IP Webcam = <a href="http://10.0.0.101">10.0.0.101</a>
<ul>
<li>Username: <code>admin</code> – Password: <code>123456</code></li>
<li>A live stream will show up if you go to the above address and login</li>
<li>A VLC stream has higher latency but can be connected by the following steps:
<ol type="1">
<li>Open VideoLAN (VLC with the construction cone icon)</li>
<li>Select <code>Media-&gt;Open Network Stream...</code></li>
<li>Enter <code>rtsp://admin:123456@10.0.0.101:554/cam1/mpeg4</code> and click connect</li>
<li>To take a snapshot click <code>Video-&gt;Take Snapshot</code>. This will save a snapshot to the users <code>Pictures</code> folder from which it can then be renamed and copied</li>
</ol>
<ul>
<li>The VLC stream has not always been reliable and may freeze. For this reason it is recommended to use the web interface except when taking snapshots of the setup</li>
</ul></li>
</ul></li>
<li>Computer = <a href="http://10.0.0.1">10.0.0.1</a>
<ul>
<li>VISA Address = N/A (local loopback is 127.0.0.1)</li>
<li>Setting Network adapter settings for local network:
<ol type="1">
<li>Go to <code>Control Panel-&gt;Network and Internet-&gt;Network Connections</code></li>
<li>Right click on the network controller for the local network and select <code>Properties</code> (admin status required)</li>
<li>Click on <code>TCP/IPv4</code> and then click <code>Properties</code></li>
<li>Click the radio button for <code>Use the following IP address</code> and type in the following parameters</li>
</ol>
<ul>
<li>IP address = 10.0.0.1</li>
<li>subnet mask = 255.0.0.0</li>
<li>Default gateway = DO NOT POPULATE</li>
</ul>
<ol start="5" type="1">
<li>Then click <code>OK</code> and <code>Close</code> to close out of the properties menu. You should now be able to access items on the local network.</li>
</ol></li>
</ul></li>
</ul>
<h1 id="running-the-samurai-software">Running the SAMURAI Software</h1>
<p>This section covers the steps required to run a SAMURAI measurement</p>
<h2 id="running-from-python-command-line-interface-cli">Running from python command line interface (CLI)</h2>
<p><em>[CLI]: Command Line Interface<br />
</em>[IDE]: Integrated Development Environment (e.g. Spyder)<br />
The following steps are to run a SAMURAI measurement from the python CLI. The steps using the python CLI here are valid for the integrated command line within the Spyder IDE. While these steps will be similar using a basic python setup, the importing of the SAMURAI classes and libraries may be a bit more complex.</p>
<h3 id="create-a-new-samurai-measurement-directory">1. Create a new SAMURAI measurement directory</h3>
<ol type="1">
<li>Make a copy of <code>meas_template</code> in the directory <code>U:\67Internal\DivisionProjects\Channel Model Uncertainty\Measurements\Synthetic_Aperture</code></li>
<li>Rename the copy to the current date in the format <code>mm-dd-yyyy</code>
<ul>
<li>From here on, this newly created directory will be referred to as <code>&lt;working-directory&gt;</code></li>
</ul></li>
<li>Copy and paste the correct comma separated value (CSV) file containing the positions into <code>&lt;working-directory&gt;/synthetic_aperture/raw</code>
<ul>
<li>Some commonly used templates are contained in <code>&lt;working-directory&gt;/synthetic_aperture/raw/position_templates</code> directory.</li>
<li>Once the desired CSV file has been copied, rename it <code>positions.csv</code></li>
</ul></li>
</ol>
<h3 id="perform-2-port-vna-calibration">2. Perform 2 Port VNA Calibration</h3>
<ol type="1">
<li>In the windows file explorer navigate to <code>&lt;working-directory&gt;/cal/calibration_pre</code></li>
<li>double click on ‘cal.pnagrabber’ to start PNAGrabber for the calibration.</li>
<li>Attach each of the standards to the calibration plane with the naming convention <code>&lt;standard-port-1&gt;_&lt;standard-port-2&gt;.s2p</code>
<ul>
<li>(e.g. load_short.s2p is load on port 1 and short on port 2)</li>
</ul></li>
<li>When the calibration is completed, make a copy of each of the <code>.s2p</code> files generated and put them into the <code>&lt;working-directory&gt;/cal/calibration_pre/raw</code> folder</li>
</ol>
<h3 id="import-the-samurai_system-module">3. Import the SAMURAI_System Module</h3>
<ol type="1">
<li>Open the python CLI (e.g. the command window in Spyder)</li>
<li>Within the command line type the following</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="im">from</span> samurai.acquisition.SAMURAI_System <span class="im">import</span> SAMURAI_System</a></code></pre></div>
<ul>
<li>NOTE: FOR NEW COMPUTERS ONLY - the code must be cloned from the gitlab repo and the directory containing the cloned <code>samurai</code> directory must be added the systems <code>PYTHONPATH</code>.</li>
</ul>
<h3 id="create-a-samurai_system-object">4. Create a SAMURAI_System Object</h3>
<ol type="1">
<li>With the SAMURAI_System module imported, create a SAMURAI_System object by typing <code>mysam = SAMURAI_System()</code> into the CLI.</li>
</ol>
<h3 id="change-directory-to-measurement-directory">5. Change directory to measurement directory</h3>
<ol type="1">
<li><p>Change the directory to <code>&lt;working-directory&gt;/synthetic_aperture/raw</code> by running the following set of commands:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> os</a>
<a class="sourceLine" id="cb3-2" title="2">os.chdir(<span class="op">&lt;</span>working<span class="op">-</span>directory<span class="op">&gt;/</span>synthetic_aperture<span class="op">/</span>raw)</a></code></pre></div>
<p>OR in certain iPython CLIs</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1">cd <span class="op">&lt;</span>working<span class="op">-</span>directory<span class="op">&gt;/</span>synthetic_aperture<span class="op">/</span>raw</a></code></pre></div></li>
</ol>
<h3 id="mount-the-antennas">6. Mount the Antennas</h3>
<ol type="1">
<li>Mount the Tx Antenna (usually port 2) to the fixed holder</li>
<li>Move the SAMURAI Robot to the mountain position using the commands below
<ul>
<li>The <code>mysam</code> object must exist for this step to work</li>
<li>Keep in mind, after this code the positioner is still connected and activated after these commands</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1">mysam.connect_rx_positioner() <span class="co">#connect and home the positioner</span></a>
<a class="sourceLine" id="cb5-2" title="2">mysam.move_to_mounting_position() <span class="co">#move to an easy position to mount the antenna</span></a></code></pre></div></li>
<li>Use the four m3 screws to attach the Antenna to the Meca500</li>
</ol>
<h3 id="open-the-robots-web-interface-optional">8. Open the Robot’s Web interface (Optional)</h3>
<p>Before running the sweep we can perform the extra step of viewing the robot’s movement and status through its web monitoring interface. To open up the web monitoring interface:</p>
<ol type="1">
<li>Open a web browser (tested in chrome)</li>
<li>type <a href="http://10.0.0.5">10.0.0.5</a> into the address bar</li>
<li>In the web interface, click the ‘Connection’ button on the top toolbar.</li>
<li>In the pop-up window select ‘Monitoring’ and click ‘Connect’</li>
</ol>
<h3 id="run-the-synthetic-aperture-sweep">8. Run the Synthetic Aperture Sweep</h3>
<p>Now we can begin the sweep</p>
<ol type="1">
<li>Ensure the working directory is set to <code>&lt;working-directory&gt;/synthetic_aperture/raw</code> (see step 5)
<ul>
<li>Some editors/IDE’s (e.g. spyder) show this in a top bar of the screen</li>
<li>The current directory can be found from a python CLI by typing <code>import os; os.getcwd()</code></li>
</ul></li>
<li>Type the following code and hit enter to begin the sweep
<ul>
<li>This step assumes the robot has previously been connected and initialized (activated and homed)</li>
<li>This also assumes the <code>mysam</code> object has already been created</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb6-1" title="1">mysam.csv_sweep(<span class="st">&#39;./&#39;</span>,<span class="st">&#39;./positions.csv&#39;</span>,template_path<span class="op">=</span><span class="st">&#39;template.pnagrabber&#39;</span>)<span class="op">;</span>disconnect_rx_positioner()</a></code></pre></div>
<ul>
<li>NOTE: If a csv file is being tested, the flag <code>run_vna=False</code> can be added to the <code>mysam.csv_sweep()</code> call to prevent the VNA from running</li>
<li>NOTE: The robot can also be put into simulation mode where all commands are sent and the web interface shows the robot moving, but the robot does not physically move. For more information on this reference the code documentation.</li>
</ul></li>
</ol>
<h3 id="unmount-the-antennas">9. Unmount the Antennas</h3>
<ol type="1">
<li>Create <code>mysam</code> object if it does not exist</li>
<li>Connect to positioner (refer to ‘Mount the Antennas’ section)</li>
</ol>
<h3 id="collect-and-save-data">10. Collect and Save data</h3>
<ol type="1">
<li>copy data from <code>&lt;working-directory&gt;/synthetic_aperture/raw</code> to <code>&lt;working-directory&gt;/synthetic_aperture/</code></li>
<li>Perform post-calibration in <code>&lt;working-directory&gt;/cal/calibration_post</code> (refer to ‘Perform 2 Port VNA Calibration’ section)</li>
</ol>
<h3 id="example-python-script">Example python script</h3>
<p>Here we have an example python script to run the sweep. This is assuming we have already created a <code>&lt;working-directory&gt;</code>. This also assumes we have placed a pnagrabber template named <code>template.pnagrabber</code> and a list of positions called <code>positions.csv</code> in <code>&lt;working-directory&gt;/synthetic_aperture/raw</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb7-1" title="1"><span class="im">import</span> os <span class="co">#import os for chdir</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="im">from</span> samurai.acquisition.SAMURAI_System <span class="im">import</span> SAMURAI_System <span class="co">#import the samurai system class</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">mysam <span class="op">=</span> SAMURAI_System() <span class="co">#create a samurai system object</span></a>
<a class="sourceLine" id="cb7-5" title="5">mysam.connect_rx_positioner() <span class="co">#connect to the Meca500 (or other positioner)</span></a>
<a class="sourceLine" id="cb7-6" title="6">mysam.move_to_mounting_position() <span class="co">#move to the position to unmount the antenna for calibration</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">###################################</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co"># Unmount antenna from Meca500</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">###</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co"># PERFORM CALIBRATION HERE</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">###</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co"># Mount antenna onto Meca500</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">###################################</span></a>
<a class="sourceLine" id="cb7-15" title="15"></a>
<a class="sourceLine" id="cb7-16" title="16">mysam.zero() <span class="co">#return the robot to its zero position</span></a>
<a class="sourceLine" id="cb7-17" title="17">os.chdir(<span class="st">&#39;&lt;working-directory&gt;/syntetic_aperture/raw&#39;</span>) <span class="co">#change into our measurement directory</span></a>
<a class="sourceLine" id="cb7-18" title="18">mysam.csv_sweep(<span class="st">&#39;./&#39;</span>,<span class="st">&#39;./positions.csv&#39;</span>,template_path<span class="op">=</span><span class="st">&#39;./template.pnagrabber&#39;</span>) <span class="co">#run the csv sweep with the vna</span></a>
<a class="sourceLine" id="cb7-19" title="19"></a>
<a class="sourceLine" id="cb7-20" title="20">mysam.disconnect_rx_positioner() <span class="co">#disconnect from the Meca500 when finished</span></a></code></pre></div>
<h2 id="running-from-the-graphical-user-interface-gui-samurgui">Running from the Graphical User Interface (GUI) SAMURGUI</h2>
<p>This code needs to be finished</p>
<h1 id="measurement-todo-list">Measurement TODO List</h1>
<ul>
<li><input type="checkbox" disabled="" checked="" />
Line of Sight Measurements</li>
<li><input type="checkbox" disabled="" checked="" />
Cylinder Measurement</li>
<li><input type="checkbox" disabled="" checked="" />
Cylinder non-LOS measurement</li>
<li><input type="checkbox" disabled="" />
Active (2 source) AoA measurements</li>
</ul>
<h1 id="code-editing-todo-list">Code Editing TODO List</h1>
<h2 id="current-work">Current Work</h2>
<ul>
<li><input type="checkbox" disabled="" />
Beamforming code for 3D and cylinder</li>
<li><input type="checkbox" disabled="" />
Angular resolution for each different aperture</li>
<li><input type="checkbox" disabled="" />
Read on AoA verification work</li>
<li><input type="checkbox" disabled="" />
Read on AoA algorithm work</li>
<li><input type="checkbox" disabled="" />
Create basic MUSIC, SAGE, Etc. algorithms</li>
<li><input type="checkbox" disabled="" />
Speed these up</li>
</ul>
<h2 id="on-backburner">On backburner</h2>
<ul>
<li><input type="checkbox" disabled="" />
allow user to move_to_mounting_position from SAMURGUI</li>
<li><input type="checkbox" disabled="" />
allow user to run csv_sweep without connect/disconnect from SAMURGUI</li>
<li><input type="checkbox" disabled="" />
add metafile editing interface to SAMURGUI</li>
<li><input type="checkbox" disabled="" />
add Meca500 status viewer in SAMURGUI</li>
</ul>
